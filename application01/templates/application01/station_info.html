<!-- station_info.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地铁车站查询-{{ station_name }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .container {
            display: flex;
            justify-content: center;
            padding: 1.5rem 5rem;
            background-color: var(--theme-color);
            flex-grow: 1;
            gap: 1rem; /* 调整为需要的值 */
        }

        .panel {
            padding: 1rem;
            box-shadow: 0 0 20px rgba(60, 60, 60, 0.3);
            background-color: rgb(255, 255, 255);
            border-radius: 3px;
        }

        .name-panel {
            padding: 0.8rem;
        }

        .train-panel {
            flex-basis: 90%;
        }

        .exit-panel {
            flex-basis: 90%;
        }

        /* 线路图标 */
        .color-circle {
            display: inline-block;
            width: 25px;  /* 圆环直径 */
            height: 25px; /* 圆环直径 */
            border-radius: 50%; /* 使div成为圆形 */
            margin-right: 8px;
            vertical-align: middle; /* 垂直居中对齐 */
            border: 2px solid; /* 添加边框以形成圆环效果 */
            box-sizing: border-box; /* 确保边框包含在宽度和高度内 */
            position: relative; /* 使内部的数字可以绝对定位 */
            background-color: white; /* 背景颜色 */
            z-index: 2;
        }

        .color-circle span {
            position: absolute;
            top: 52%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px; /* 调整字体大小 */
            color: black; /* 文字颜色 */
            line-height: 2; /* 确保文字垂直居中 */
            z-index: 2;
        }

        /* 标题-站名字段 */
        .station-name {
            font-size: 22px;
            padding-left: 6px;
            padding-right: 12px;
            text-align: right; /* 文本右对齐 */
        }

        /* 标题-线路与设施图标 */
        .station-icons {
            display: flex;
            align-items: center;
            margin-top: 7px; /* 对齐文本 */
        }

        /* 首末班车列表-标题 */
        .panel-title {
            background-color: white; /* 默认白色背景 */
            border: 1px solid var(--theme-color); /* 主题色边框 */
            color: var(--theme-color); /* 主题色文字 */
            padding: 8px 16px; /* 内边距 */
            border-radius: 4px; /* 圆角 */
            margin: 10px 0; /* 上下外边距 */
            text-align: center; /* 文本居中 */
            font-weight: bold; /* 加粗字体 */
            transition: background-color 0.3s ease, color 0.3s ease; /* 平滑过渡效果 */
        }

        /* 首末班车列表项 */
        .train-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }

        /* 首末班车列表项-方向字段 */
        .train-direction {
            display: flex;
            flex-basis: 40%;
        }

        /* 首末班车列表项-首班车 */
        .train-first {
            text-align: center; /* 文本居中 */
            flex-basis: 30%;
        }

        /* 首末班车列表项-末班车 */
        .train-last {
            text-align: center; /* 文本居中 */
            flex-basis: 30%;
        }

        /* 出口列表项 */
        .exit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }

        /* 出口列表项-名称字段 */
        .exit-name {
            display: flex;
            flex-basis: 20%;
        }

        /* 出口列表项-地址字段 */
        .exit-address {
            flex-basis: 80%;
        }

    </style>
</head>
<body>
    <header>
        <h1>地铁车站查询</h1>
    </header>
    <main>
        <div class="container">
            <div class="panel name-panel" data-station-name="{{ station_name }}">
            </div>
        </div>
        <div class="container">
            <div class="panel train-panel">
                <div class="panel-title" role="heading">
                    首末班车时间
                </div>
                <ul id="train-list">
                    <!-- 默认情况下为空 -->
                </ul>
            </div>
        </div>
        <div class="container">
            <div class="panel exit-panel">
                <div class="panel-title" role="heading">
                    出口资讯
                </div>
                <ul id="exit-list">
                    <!-- 默认情况下为空 -->
                </ul>
            </div>
        </div>
    </main>

    <script>
        // 绘制所有内容
        document.addEventListener('DOMContentLoaded', function () {
            // 从DOM中获取station_name
            const stationNameElement = document.querySelector('.name-panel');
            const stationName = stationNameElement.getAttribute('data-station-name');
            fetch(`/get_station_info/${stationName}/`)
                .then(response => response.json())
                .then(data => {
                    // 绘制出入口部分
                    const exitList = document.getElementById('exit-list');

                    // 检查data.exits是否存在且不是空列表
                    if (Array.isArray(data.exits) && data.exits.length > 0) {
                        data.exits.forEach(exit => {
                            const listItem = document.createElement('li');
                            listItem.className = 'exit-item';

                            // 出口名称部分
                            const exitNameDiv = document.createElement('div');
                            exitNameDiv.className = 'exit-name';

                            // 创建出口编号元素
                            const exitNoSpan = document.createElement('span');
                            exitNoSpan.textContent = exit.exit_name;
                            exitNoSpan.style.fontSize = '1.6em';
                            exitNoSpan.style.marginLeft = '4px';
                            exitNoSpan.style.marginRight = '4px';
                            exitNoSpan.style.color = 'var(--theme-color)';

                            // 创建“出口”文本元素，并使其底端对齐
                            const exitTextSpan = document.createElement('span');
                            exitTextSpan.textContent = '出口';
                            exitTextSpan.style.verticalAlign = 'bottom';
                            exitTextSpan.style.position = 'relative';
                            exitTextSpan.style.bottom = '-0.3em'; // 对齐文本

                            exitNameDiv.appendChild(exitNoSpan);
                            exitNameDiv.appendChild(exitTextSpan);

                            // 地址部分
                            const exitAddressDiv = document.createElement('div');
                            exitAddressDiv.className = 'exit-address';

                            const addressMain = document.createElement('p');
                            addressMain.className = 'address-main';
                            addressMain.textContent = exit.exit_address;
                            addressMain.style.margin = '0';
                            addressMain.style.padding = '0';

                            const addressSub = document.createElement('p');
                            addressSub.className = 'address-sub';
                            addressSub.textContent = exit.exit_sub_address ||'\u00A0';
                            addressSub.style.margin = '0';
                            addressSub.style.marginTop = '2px';
                            addressSub.style.padding = '0';
                            addressSub.style.fontSize = '0.875em';
                            addressSub.style.color = '#777';

                            exitAddressDiv.appendChild(addressMain);
                            exitAddressDiv.appendChild(addressSub);

                            listItem.appendChild(exitNameDiv);
                            listItem.appendChild(exitAddressDiv);

                            exitList.appendChild(listItem);
                        });
                    } else {
                        // 如果没有数据，可以显示一个提示信息
                        const noDataItem = document.createElement('li');
                        noDataItem.textContent = '暂无出口信息';
                        exitList.appendChild(noDataItem);
                    }

                    // 绘制首末班车部分
                    const trainList = document.getElementById('train-list');

                    // 检查data.trains是否存在且不是空列表
                    if (Array.isArray(data.trains) && data.trains.length > 0) {
                        // 先添加表头
                        const listItem = document.createElement('li');
                        listItem.className = 'train-item';
                        listItem.style.marginTop = '4px'; // 增加行高

                        const directionDiv = document.createElement('div');
                        directionDiv.className = 'train-direction';

                        const firstTrainDiv = document.createElement('div');
                        firstTrainDiv.className = 'train-first';
                        firstTrainDiv.textContent = '首班车';

                        const lastTrainDiv = document.createElement('div');
                        lastTrainDiv.className = 'train-last';
                        lastTrainDiv.textContent = '末班车';

                        listItem.appendChild(directionDiv);
                        listItem.appendChild(firstTrainDiv);
                        listItem.appendChild(lastTrainDiv);

                        trainList.appendChild(listItem);

                        // 遍历列车数据
                        data.trains.forEach(train => {
                            const listItem = document.createElement('li');
                            listItem.className = 'train-item';
                            listItem.style.marginTop = '4px'; // 增加行高

                            // 方向字段
                            const directionDiv = document.createElement('div');
                            directionDiv.className = 'train-direction';

                            // icon部分
                            const iconsDiv = document.createElement('div');
                            iconsDiv.className = 'station-icons';
                            iconsDiv.style.display = 'flex'; // 使用 Flexbox 布局
                            iconsDiv.style.alignItems = 'center'; // 垂直居中对齐
                            iconsDiv.style.gap = '4px'; // 图标之间的间距

                            const lineIcon = document.createElement('span');
                            lineIcon.style.position = 'relative';

                            const lineCircle = document.createElement('span');
                            lineCircle.className = 'color-circle';
                            lineCircle.style.borderColor = train.colour;
                            lineCircle.style.marginTop = '-14px'; // 对齐文本
                            const lineNoSpan = document.createElement('span');
                            lineNoSpan.textContent = train.line_no;
                            lineCircle.appendChild(lineNoSpan);
                            lineIcon.appendChild(lineCircle);

                            iconsDiv.appendChild(lineIcon);

                            // 方向名部分
                            const directionNameDiv = document.createElement('div');
                            directionNameDiv.className = 'direction-name';
                            directionNameDiv.textContent = `开往 ${train.direction} 方向`;

                            // 将各部分添加到 directionDiv
                            directionDiv.appendChild(iconsDiv);
                            directionDiv.appendChild(directionNameDiv);

                            // 首末班车时间字段
                            const firstTrainDiv = document.createElement('div');
                            firstTrainDiv.className = 'train-first';
                            firstTrainDiv.textContent = train.first_train_time;

                            const lastTrainDiv = document.createElement('div');
                            lastTrainDiv.className = 'train-last';
                            lastTrainDiv.textContent = train.last_train_time;

                            listItem.appendChild(directionDiv);
                            listItem.appendChild(firstTrainDiv);
                            listItem.appendChild(lastTrainDiv);

                            trainList.appendChild(listItem);
                        });
                    } else {
                        // 如果没有数据，可以显示一个提示信息
                        const noDataItem = document.createElement('li');
                        noDataItem.textContent = '暂无首末班车信息';
                        trainList.appendChild(noDataItem);
                    }

                    // 绘制站名部分
                    const namePanel = document.querySelector('.name-panel');

                    // 包含站名所有信息的 div
                    const nameItemDiv = document.createElement('div');
                    nameItemDiv.style.display = 'flex'; // 使用 Flexbox 布局
                    nameItemDiv.style.alignItems = 'center'; // 垂直居中对齐
                    nameItemDiv.style.width = '100%'; // 占据整个父元素的宽度
                    nameItemDiv.margin = 0; /* 去除默认的外边距 */
                    nameItemDiv.padding = 0; /* 去除默认的内边距 */

                    // 创建车站名称的 div
                    const stationNameDiv = document.createElement('div');
                    stationNameDiv.className = 'station-name';
                    stationNameDiv.textContent = data.name;

                    // 创建线路编号和设施图标的 div
                    const iconsDiv = document.createElement('div');
                    iconsDiv.className = 'station-icons';
                    iconsDiv.style.display = 'flex'; // 使用 Flexbox 布局
                    iconsDiv.style.alignItems = 'center'; // 垂直居中对齐
                    iconsDiv.style.gap = '1px'; // 图标之间的间距

                    data.lines.forEach((line, lineIndex) => {
                        // 为每个线路创建容器
                        const lineIcon = document.createElement('span');
                        lineIcon.style.position = 'relative';

                        // 线路标识
                        const lineCircle = document.createElement('span');
                        lineCircle.className = 'color-circle';
                        lineCircle.style.borderColor = line.colour;
                        const lineNoSpan = document.createElement('span');
                        lineNoSpan.textContent = line.line_no;
                        lineCircle.appendChild(lineNoSpan);
                        lineIcon.appendChild(lineCircle);

                        iconsDiv.appendChild(lineIcon);
                    });

                    data.facilities.forEach(facility => {
                        if (facility.icon_image_data) {
                            const facilityIcon = document.createElement('img');
                            facilityIcon.src = `data:image/png;base64,${facility.icon_image_data}`; // 设置Base64编码的图片数据
                            facilityIcon.alt = `${facility.facility_type} icon`;
                            facilityIcon.style.marginTop = '5px'; // 对齐水平线
                            facilityIcon.style.marginRight = '-4px'; // 缩短设施图标的间距
                            facilityIcon.style.transform = 'scale(0.7)';
                            facilityIcon.style.transformOrigin = 'top left'; // 缩放的起始点设为左上角
                            iconsDiv.appendChild(facilityIcon);
                        }
                    });

                    // 将各项添加到name-panel中
                    nameItemDiv.appendChild(stationNameDiv);
                    nameItemDiv.appendChild(iconsDiv);

                    namePanel.appendChild(nameItemDiv);


                })
                .catch(error => console.error('Error fetching stations:', error));



        });

    </script>

</body>
</html>